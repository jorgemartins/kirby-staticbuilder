Kirby StaticBuilder options
===========================


StaticBuilder offers a handful of options so that you can tweak the result, depending on your taste or your technical requirements. Need to export a documentation that can be shared as a folder of files (rather than hosted on a web server)? That’s doable. Only export part of a website? Sure.


## Activating the plugin

Enabling this plugin takes a single line of PHP, but we’re going to take a detour first because you probably *don’t want to enable this plugin on a live website*.

So let’s say we only want to enable Kirby StaticBuilder on your own computer. What is the URL you use to access your site locally? Typically it would look like one of those:

- `http://localhost/`
- `http://localhost:8080/`
- `http://test.mywebsite.dev/`

If you don’t have one yet, you should create a config file just for this domain in your `site/config` directory, for instance:

- `site/config/config.localhost.php` (works for the first 2 examples)
- `site/config/config.test.mywebsite.dev.php` (works for the last one)

Then in this domain-specific config file, add:

```php
<?php
// Enable Kirby StaticBuilder locally
c::set('plugin.staticbuilder.enabled', true);
```

You should now be able to load `http://[local-domain]/staticbuilder/` and see a list of your site’s pages.


## Option defaults

```php
c::set([
    'plugin.staticbuilder.enabled'    => false,
    'plugin.staticbuilder.outputdir'  => 'static',
    'plugin.staticbuilder.baseurl'    => '/',
    'plugin.staticbuilder.assets'     => ['assets', 'content', 'thumbs'],
    'plugin.staticbuilder.filter'     => null,
    'plugin.staticbuilder.filename'   => '.html',
    'plugin.staticbuilder.uglyurls'   => false,
    'plugin.staticbuilder.pagefiles'  => false,
    'plugin.staticbuilder.catcherror' => true
]);
```

## Common scenarios

### Hosting on a domain or subdomain

With default settings you should be able to put the contents of the `static` folder directly on your website’s root.

- Page files will look like: `my/page.html`
- URLs will look like: `/my/page`

Make sure that your server config allows serving `my/page.html` when requesting the `/my/page` URL.

With Apache, this requires the `Multiviews` options, which you can probably enable in an `.htaccess` file if needed:

```apache
Options +Multiviews
```

### Copying page files

There are several options for copying page files and making sure that your links and file references still work.

1. Copy the thumbs folder. By default the `thumbs` folder will be copied, and if all images you’re using in your pages go through the `thumb()` helper or `$image->thumb()` method, you’re golden.

2. Copy the content folder and use Kirby tags. By default the `content` folder will be copied as well, so that links to `content/1-section/3-page/myfile.pdf` etc. keep working. If you used Kirby tags to embed images and link to page files, you don’t have anything else to do.

3. Tell StaticBuilder to copy page files to a folder named after the page: e.g. `section/page/myfile.pdf`.

The last option will work for relative paths in your HTML (`<a href="myfile.pdf">My File</a>` or `<img src="hello.svg" alt="">`) *only if* the page HTML is written to the same folder. So you probably want to use the `filename` and `pagefiles` options together:

```php
c::set([
    'plugin.staticbuilder.enabled'   => true,
    'plugin.staticbuilder.filename'  => 'index.html',
    'plugin.staticbuilder.pagefiles' => true
]);
```

### HTML pages outside of a web site

If you need to share the resulting site outside of a web server (on a local network share for documentation, on a thumb drive, distributed as a ZIP file, etc.), you will need fully relative URLs between pages.

This can be achieved with this configuration:

```php
c::set([
    'plugin.staticbuilder.enabled'  => true,
    'plugin.staticbuilder.baseurl'  => '.',
    'plugin.staticbuilder.uglyurls' => true
]);
```

In the output, URLs from page A to page B should look like: `./../other-section/page-b.html`.

Note that this plugin only rewrites URLs that are generated by Kirby objects or by the `url()` helper function. If you hardcoded some URLs or paths in your templates, they won’t be rewritten.


## Option details

### `plugin.staticbuilder.outputdir`

By default, the static site will be generated in `[yourproject]/static`. You can change this path, providing a relative path (e.g. `../build/static`) or an absolute one (e.g. `/Users/me/Sites/mywebsite/static`).

Two restrictions:

1.  PHP and your local web server (Apache/MAMP/WAMP/etc.) must permissions to write to that folder.
2.  The output folder MUST be named `static`, even if you change the path. This restriction helps making sure you don’t kill your system or delete existing files.

WARNING: when building the site, the contents of this folder will be deleted first. You should not change the contents of this folder manually, or you will lose your changes on the next build!

### `plugin.staticbuilder.baseurl`

This overrides Kirby’s default `'url'` option.

```php
// Works well for hosting on a domain or subdomain
c::set('plugin.staticbuilder.baseurl', '/');

// If hosting in a subfolder
c::set('plugin.staticbuilder.baseurl', '/something');

// You can provide a full URL if you want, but that will
// probably make it harder to test the result locally
c::set('plugin.staticbuilder.baseurl', 'http://mysite.com');
```

Finally, there is a magic value for relative URLs:

```php
// Change all URLs to fully relative
c::set('plugin.staticbuilder.baseurl', '.');
```

Then URLs from page A to page B should look like `./../../other-section/page-b`.

WARNING: relative URLs are only computed for URLs generated by Kirby, using the `$page->url()`, `$file->url()`, `$thumb->url()` etc. methods, or the `url('some/path')` method. If you have hardcoded URLs in your templates or in your content, they will not be modified!

### `plugin.staticbuilder.assets`

A list of static files or folders to copy in the `static` directory.

```php
c::set('plugin.staticbuilder.assets', [
    // Copy the full 'assets' folder
    'assets',
    // Thumbs too
    'thumbs',
    // Use key=>value syntax to change the destination
    'assets/images/favicon.ico' => 'favicon.ico',
    // Getting a file from outside the main project dir
    '../server/static-htaccess.conf' => '.htaccess'
]);
```

Note: `*` or other wildcards are not supported. You need explicit paths to existing files or folders.

### `plugin.staticbuilder.filter`

With this option you can provide a PHP callback that gets each Page object as its only parameter, and which should return `true` for pages to build and `false` for pages to exclude.

The default filter is equivalent to:

```php
c::set('plugin.staticbuilder.filter', function($page){
    // Only include pages which have an existing text file
    return file_exists($page->textfile());
});
```

This example filters out pages that do not match the specified template names:

```php
c::set('plugin.staticbuilder.filter', function($page){
    return in_array($page->template(), ['page', 'post', 'blog', 'error', 'home']);
});
```

### `plugin.staticbuilder.filename`

File name or extension to use for pages. It’s treated as an extension if it starts with a dot, and as a file name otherwise:

```php
c::set('plugin.staticbuilder.filename', '.html');      // my/page.html
c::set('plugin.staticbuilder.filename', 'index.html'); // my/page/index.html
```

### `plugin.staticbuilder.uglyurls`

Should we include the filename or extension in page URLs or not? (Defaults to false.)

```php
// Page URL might look like:
//   /my/page
c::set('plugin.staticbuilder.uglyurls', false);

// Page URL might look like:
//   /my/page.html (default)
//   /my/page/index.html (custom filename config)
c::set('plugin.staticbuilder.uglyurls', true);
```

### `plugin.staticbuilder.pagefiles`

Should we copy page files in their parent’s target directory? (Defaults to false.)

```php
// Copy a page’s files (images, documents etc.), e.g.
// content/1-my/3-page/image.jpg -> static/my/page/image.jpg
// content/1-my/3-page/doc.pdf   -> static/my/page/doc.pdf
c::set('plugin.staticbuilder.pagefiles', true);
```

Note that for multilingual sites this would copy the files for each language (if you have 3 languages, each file gets copied to 3 different locations).

### `plugin.staticbuilder.catcherror`

Should we catch and display PHP errors that happen while building the HTML for a page? (Defaults to true.)

Note: this will only display the error more nicely in the StaticBuilder web page. If your templates or plugins have uncaught PHP Exceptions or PHP errors (e.g. syntax and parse errors, fatal errors), generating the HTML pages will be stopped.

If you’re building 10 pages and the third one has an error, then only the first 2 will be built and written to the `static` folder. To prevent that:

1.  Fix errors. :)
2.  Or exclude the buggy page(s), using the `filter` option.
